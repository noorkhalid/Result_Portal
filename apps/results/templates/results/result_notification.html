{% load static %}
{% load results_extras %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    @page { size: A4 landscape; margin: 18mm 12mm; }

    body{
      font-family: "Times New Roman", serif;
      font-size: 12px;
      color:#000;
    }

    .row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .center{ text-align:center; }
    .bold{ font-weight:700; }
    .u{ text-decoration: underline; }
    .mt8{ margin-top:8px; }
    .mt12{ margin-top:12px; }
    .mt16{ margin-top:16px; }

    .logo{
      width:70px;
      height:auto;
    }

    .title h1{
      font-size: 22px;
      margin:0;
      letter-spacing:.4px;
    }
    .title h2{
      font-size: 16px;
      margin:2px 0 0 0;
      font-weight:700;
    }
    .title h3{
      font-size: 14px;
      margin:2px 0 0 0;
      font-weight:700;
    }

    .topline{
      font-size: 13px;
      display:flex;
      justify-content:space-between;
      margin-top:10px;
    }

    .boxline{
      text-align:center;
      font-size: 13px;
      margin-top:10px;
      line-height: 1.35;
    }

    .meta{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      font-size: 12px;
    }
    .meta td{
      padding:4px 6px;
      vertical-align:top;
    }
    .meta .label{ width:120px; font-weight:700; }

    table.main{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      table-layout: fixed;
      font-size: 12px;
    }
    table.main th, table.main td{
      border:1px solid #000;
      padding:6px 5px;
      text-align:center;
      vertical-align:middle;
      word-wrap: break-word;
    }

    table.main thead th{
      font-weight:700;
    }

    .subj-title{
      font-size: 11px;
      line-height: 1.15;
      font-weight:700;
    }
    .subj-ch{
      font-size: 10px;
      margin-top:4px;
      font-weight:700;
    }

    .leftcell{
      text-align:left !important;
      padding-left:6px !important;
    }

    .foot{
      margin-top:34px; /* space for signatures/stamps */
      display:flex;
      justify-content:space-between;
      font-size: 12px;
      gap:24px;
    }
    .foot .sig{
      width:45%;
      text-align:center; /* stamp/signature text centered in each side */
    }
  </style>
</head>

<body>

  <!-- Header (logo centered on top) -->
  <div class="center">
    <img class="logo" src="{% static 'img/university_logo.png' %}" alt="Logo" style="display:block; margin:0 auto 6px auto;">
    <div class="title">
      <h1>EXAMINATIONS SECTION</h1>
      <h2>Gomal University, Dera Ismail Khan</h2>
    </div>
  </div>

  <!-- Notification / Date line -->
  <div class="topline">
    <div class="bold u">Notification No. {{ batch.notification_no|default:"________" }}</div>
    <div class="bold u">Dated: {{ batch.notification_date|date:"d-m-Y"|default:"________" }}</div>
  </div>

  <!-- Center institution block (Excel-like) -->
  <div class="boxline mt12">
    <div class="bold">{{ batch.program.department.name|upper }}</div>
    <div class="bold">AFFILIATED WITH GOMAL UNIVERSITY, DERA ISMAIL KHAN</div>
    <div class="bold">(Results are Provisionally Declared, Subject to the Verification of the Documents)</div>
  </div>

  <!-- Degree/Semester/Session/Result Type -->
  <table class="meta mt12">
    <tr>
      <td class="label">Degree</td>
      <td class="bold">{{ batch.program.name }}</td>

      <td class="label">Session</td>
      <td class="bold">{{ session_display }}</td>
    </tr>
    <tr>
      <td class="label">Semester</td>
      <td class="bold">{{ batch.semester_number|ordinal }}</td>

      <td class="label">Result Type</td>
      <td class="bold">{{ result_type_label }}</td>
    </tr>
  </table>

  <!-- Main Result Table -->
  <table class="main mt12">
    <thead>
      <tr>
        <th rowspan="2" style="width:90px;">R.No.</th>
        <th rowspan="2" style="width:110px;">Registration No.</th>
        <th rowspan="2" style="width:140px;">Name</th>
        <th rowspan="2" style="width:140px;">Father's Name</th>

        {% for col in columns %}
          <th>
            <div class="subj-title">{{ col.title }}</div>
          </th>
        {% endfor %}

        <th rowspan="2" style="width:70px;">SGPA</th>
        {% if show_cgpa %}
          <th rowspan="2" style="width:70px;">CGPA</th>
        {% endif %}
      </tr>

      <tr>
        {% for col in columns %}
          <th>
            <div class="subj-ch">{{ col.credit_hours }}</div>
          </th>
        {% endfor %}
      </tr>
    </thead>

    <tbody>
      {% for r in results %}
        <tr>
          <td>{{ r.enrollment.roll_no }}</td>
          <td class="leftcell">{{ r.enrollment.student.registration_no }}</td>
          <td class="leftcell">{{ r.enrollment.student.name }}</td>
          <td class="leftcell">{{ r.enrollment.student.father_name }}</td>

          {% for col in columns %}
            <td>
              {% with row=grades_map|get_item:r.enrollment_id %}
                {{ row|get_item:col.course_id }}
              {% endwith %}
            </td>
          {% endfor %}

          <td>{{ r.gpa }}</td>
          {% if show_cgpa %}
            <td>{{ r.cgpa }}</td>
          {% endif %}
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="foot">
    <div class="sig">
      <div class="bold">Assistant Controller of Examinations (Secrecy)</div>
      <div class="bold">Gomal University, Dera Ismail Khan</div>
    </div>
    <div class="sig">
      <div class="bold">Controller of Examinations</div>
      <div class="bold">Gomal University, Dera Ismail Khan</div>
    </div>
  </div>

</body>
</html>
